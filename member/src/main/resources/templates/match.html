<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>매치 선택</title>
    <link rel="stylesheet" href="/css/match.css">
</head>
<body>
    <div class="background-blur"></div>
    <div class="container">
        <div class="table-selector">
            <label for="season">테이블 선택:</label>
            <select id="table" name="table" onchange="updateTeams()">
                <option value="">-- 선택 --</option>
                <option th:each="tableName : ${tableNames}" th:value="${tableName}" th:text="${tableName}"></option>
            </select>
        </div>

        <div class="team-selector">
            <label for="team">팀 선택:</label>
            <select id="team" name="team" onchange="fetchMatches()">
                <option value="">-- 선택 --</option>
            </select>
        </div>

        <div id="matches">
            <table>
                <thead>
                    <tr>
                        <th>Season</th>
                        <th>Date</th>
                        <th>Team</th>
                        <th>Team Score</th>
                        <th>Opponent Score</th>
                        <th>Opponent Team</th>
                        <th>Champion</th>
                        <th>Opponent Champion</th>
                        <th>Player</th>
                        <th>Opponent Player</th>
                        <th>KDA</th>
                        <th>Opponent KDA</th>
                        <th>Damage</th>
                        <th>Opponent Damage</th>
                        <th>Sight</th>
                        <th>Opponent Sight</th>
                        <th>CS</th>
                        <th>Opponent CS</th>
                        <th>Per CS</th>
                        <th>Opponent Per CS</th>
                    </tr>
                </thead>
                <tbody id="match-data">
                    <!-- 데이터는 JavaScript를 통해 동적으로 삽입됩니다 -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function updateTeams() {
            const season = document.getElementById('table').value;
            if (!season) return;

            fetch(`/api/teams?season=${season}`)
                .then(response => response.json())
                .then(teams => {
                    const teamSelect = document.getElementById('team');
                    teamSelect.innerHTML = '<option value="">-- 선택 --</option>';
                    teams.forEach(team => {
                        const option = document.createElement('option');
                        option.value = team;
                        option.textContent = team;
                        teamSelect.appendChild(option);
                    });
                });
        }

        function fetchMatches() {
            const season = document.getElementById('table').value;
            const team = document.getElementById('team').value;
            if (!season || !team) return;

            fetch(`/api/matches?season=${season}&team=${team}`)
                .then(response => response.json())
                .then(data => {
                    const matchData = document.getElementById('match-data');
                    if (data.length === 0) {
                        matchData.innerHTML = '<tr><td colspan="20">데이터가 없습니다.</td></tr>';
                        return;
                    }

                    matchData.innerHTML = data.map(row => `
                        <tr>
                            <td>${row.Season}</td>
                            <td>${row.Date}</td>
                            <td>${row.Team}</td>
                            <td>${row.Team_Score}</td>
                            <td>${row.Opponent_Score}</td>
                            <td>${row.Opponent_Team}</td>
                            <td>${row.Champion}</td>
                            <td>${row.Opponent_Champion}</td>
                            <td>${row.Player}</td>
                            <td>${row.Opponet_Player}</td>
                            <td>${row.KDA}</td>
                            <td>${row.Opponent_KDA}</td>
                            <td>${row.Damage}</td>
                            <td>${row.Opponent_Damage}</td>
                            <td>${row.Sight}</td>
                            <td>${row.Opponent_Sight}</td>
                            <td>${row.CS}</td>
                            <td>${row.Opponent_CS}</td>
                            <td>${row.Per_CS}</td>
                            <td>${row.Opponent_Per_CS}</td>
                        </tr>
                    `).join('');
                });
        }
    </script>
</body>
</html>
